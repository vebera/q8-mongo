# MongoDB Configuration File
# Production-optimized settings for Q8 tenant databases

# Storage Configuration
storage:
  dbPath: /data/db
  # Note: journal.enabled is not needed in MongoDB 7.0+
  # WiredTiger always uses journaling
  wiredTiger:
    engineConfig:
      # Cache size will be overridden by command line --wiredTigerCacheSizeGB
      # Default: 60-70% of available RAM
      # For CCX43 (48GB): 32GB
      # For CCX53 (64GB): 40GB
      cacheSizeGB: 32
      journalCompressor: snappy
      directoryForIndexes: false
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: true

# System Logging
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log
  logRotate: rename
  verbosity: 1
  component:
    accessControl:
      verbosity: 1
    command:
      verbosity: 1

# Network Configuration
net:
  port: 27017
  # SECURITY: Bind to all interfaces inside container (required for Docker networking)
  # Access is restricted by Docker port binding to private IP (10.0.0.2) in docker-compose.yml
  bindIp: 0.0.0.0
  maxIncomingConnections: 1000
  compression:
    compressors: snappy,zstd

# Process Management
processManagement:
  fork: false  # Docker handles forking
  pidFilePath: /var/run/mongodb/mongod.pid

# Security
security:
  authorization: enabled
  # Keyfile for replica set (if using)
  # keyFile: /etc/mongodb/mongodb-keyfile

# Operation Profiling
operationProfiling:
  mode: slowOp
  slowOpThresholdMs: 100
  slowOpSampleRate: 1.0

# Replication (for future replica set)
# replication:
#   replSetName: "q8-rs0"
#   oplogSizeMB: 10240

# Sharding (for future scaling)
# sharding:
#   clusterRole: configsvr  # or shardsvr

# Set Parameters
setParameter:
  # Connection pool settings
  connPoolMaxConnsPerHost: 200
  
  # Query execution
  
  # Write concern
  journalCommitInterval: 100  # milliseconds
  
  # Logging
  logLevel: 1
  
  # Performance
  enableLocalhostAuthBypass: false
  ttlMonitorEnabled: true
  
  # Security
  authenticationMechanisms: SCRAM-SHA-1,SCRAM-SHA-256